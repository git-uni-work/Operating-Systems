<!DOCTYPE html>
<!-- saved from url=(0070)https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html -->
<html class="js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./CPU_files/screen.css" type="text/css" media="screen">
  <link rel="stylesheet" href="./CPU_files/print.css" type="text/css" media="print">
  <link rel="stylesheet" href="./CPU_files/katex.min.css">
      <title>Seminar project #1: Single-cycle CPU design • BIE-APS • FIT CTU Course Pages</title>
      <script src="./CPU_files/main.js.download"></script>
</head>
  <body>
<div class="wrap">
  <div class="menubar app-menu" role="menubar">
    <ul>
      <!-- <li><a href="#">
        <span class="label">Notifications</span>
      </a></li> -->
      <li class="user dropdown" id="userbar">
        <span class="label">Logged in user</span>
        <a class="username" id="username" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#">samymbas</a>
        <span class="icon icon-expand"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="expand" width="50" height="50" fill="none"></rect><path d="M10 20.25l15.105 9.5L40 20.25" fill="none" stroke="#000" stroke-width="3"></path></svg></span>
        <ul>
          <li>
            <form method="POST" action="https://courses.fit.cvut.cz/_oauth/logout">
              <button class="link">Log out</button>
            </form>
          </li>
        </ul>
      </li>
      <li class="user hidden" id="login-link">
        <form method="POST" action="https://courses.fit.cvut.cz/_oauth/login">
          <button class="link">Log in</button>
        </form>
      </li>
    </ul>
  </div>
  <div class="header">
    <div class="subheading subheading-portal">
      <a href="https://courses.fit.cvut.cz/">FIT CTU Course Pages</a>
    </div>
    <div class="heading-group">
      <div class="course-heading">
        BIE-APS
        <span class="dash">—</span>
        <span class="fullname">Architectures of Computer Systems</span>
      </div>
      <div class="menubar page-menu">
        <ul>
          <li class="course-semester">
            <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#">
              <span class="icon icon-history"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="history" width="50" height="50" fill="none"></rect><path d="M10.861 10.861A19.934 19.934 0 0 1 25 5c11.038 0 20 8.962 20 20s-8.962 20-20 20S5 36.038 5 25" fill="none" stroke="#000" stroke-width="3"></path><path d="M10 5v7h7M20 33l6-5V15" fill="none" stroke="#000" stroke-width="3"></path></svg></span>&nbsp;<span class="label">Past semesters</span><span class="icon icon-expand"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="expand" width="50" height="50" fill="none"></rect><path d="M10 20.25l15.105 9.5L40 20.25" fill="none" stroke="#000" stroke-width="3"></path></svg></span>
            </a>
            <ul id="semesters"><li><a href="https://courses.fit.cvut.cz/BIE-APS/@B101/">B101</a></li>
<li><a href="https://courses.fit.cvut.cz/BIE-APS/@B131/">B131</a></li>
<li><a href="https://courses.fit.cvut.cz/BIE-APS/@B141/">B141</a></li>
<li><a href="https://courses.fit.cvut.cz/BIE-APS/@B151/">B151</a></li>
<li><a href="https://courses.fit.cvut.cz/BIE-APS/@B161/">B161</a></li>
<li><a href="https://courses.fit.cvut.cz/BIE-APS/@B171/">B171</a></li>
<li><a href="https://courses.fit.cvut.cz/BIE-APS/@B181/">B181</a></li>
<li><a href="https://courses.fit.cvut.cz/BIE-APS/@B201/">B201</a></li>
<li><a href="https://courses.fit.cvut.cz/BIE-APS/">master</a></li></ul>
          </li>
          <li><a href="https://gitlab.fit.cvut.cz/BI-APS/bie-aps/blob/master/tutorials/05/semester_project.adoc">
            <span class="icon icon-gitlab"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="gitlab" width="50" height="50" fill="none"></rect><path d="M13.072 7.623l4.843 13.933 13.992-.178 4.486-14.052 7.651 20.894-18.863 14.454L5.956 28.706l7.116-21.083z" fill="none" stroke="#000" stroke-width="3"></path></svg></span>&nbsp;<span class="label">View on GitLab</span>
          </a></li>
          <li><a href="https://gitlab.fit.cvut.cz/BI-APS/bie-aps/issues/new?issue[title]=tutorials/05/semester_project.adoc:%20">
            <span class="icon icon-danger"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="danger" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M25 13.56v12.403M25 35.56v.88"></path></g><circle cx="25" cy="25" r="20" fill="none" stroke="#000" stroke-width="3"></circle></svg></span>&nbsp;<span class="label">Report issue</span>
          </a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="horizont">
    <main>
      <div class="display-menu">
      </div>
      <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#nav" class="nav-link">Go to course navigation</a>
        <h1>Seminar project #1: Single-cycle CPU design</h1>
      <section class="doc-section level-1"><h2 id="_seminar-project-1-single-cycle-cpu-design"><a class="anchor" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#_seminar-project-1-single-cycle-cpu-design" aria-hidden="true"></a>Seminar project #1: Single-cycle CPU design</h2><section class="doc-section level-3"><h4 id="_basic-cpu-design"><a class="anchor" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#_basic-cpu-design" aria-hidden="true"></a>Basic CPU design</h4><p>Design a simple 32-bit processor connected to a separate instruction and data memory. The processor has to implement instructions given  in the table bellow. Suppose that the processor starts the execution from the beginning of instruction memory (0x00000000).<br></p>
<div class="image-block"><img src="./CPU_files/cpu.png" alt="cpu" width="580"></div>
<div class="table-block"><table class="frame-all grid-all"><colgroup><col><col><col><col></colgroup><tbody><tr><th class="halign-left valign-top">Instruction</th><th class="halign-left valign-top">Syntax</th><th class="halign-left valign-top">Operation</th><th class="halign-left valign-top">Note</th></tr><tr><td class="halign-left valign-top">add</td><td class="halign-left valign-top">add rd, rs1, rs2</td><td class="halign-left valign-top">rd ← [rs1] + [rs2];</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">addi</td><td class="halign-left valign-top">addi rd, rs1, imm<sub>11:0</sub></td><td class="halign-left valign-top">rd ← [rs1] + imm<sub>11:0</sub>;</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">addu.qb</td><td class="halign-left valign-top">addu.qb rd, rs1, rs2</td><td class="halign-left valign-top">rd<sub>31:24</sub> ← [rs1<sub>31:24</sub>] + [rs2<sub>31:24</sub>];  rd<sub>23:16</sub> ← [rs1<sub>23:16</sub>] + [rs2<sub>23:16</sub>]; etc.</td><td class="halign-left valign-top">User-defined SIMD instr.</td></tr><tr><td class="halign-left valign-top">and</td><td class="halign-left valign-top">and rd, rs1, rs2</td><td class="halign-left valign-top">rd ← [rs1] &amp; [rs2];</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">sub</td><td class="halign-left valign-top">sub rd, rs1, rs2</td><td class="halign-left valign-top">rd ← [rs1] - [rs2];</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">slt</td><td class="halign-left valign-top">slt rd, rs1, rs2</td><td class="halign-left valign-top">if [rs1] &lt; [rs2] then rd←1; else rd←0;</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">beq</td><td class="halign-left valign-top">beq rs1, rs2, imm<sub>12:1</sub></td><td class="halign-left valign-top">if [rs1] == [rs2] go to [PC]+{imm<sub>12:1</sub>,'0'}; else go to [PC]+4;</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">lw</td><td class="halign-left valign-top">lw rd,imm<sub>11:0</sub>(rs1)</td><td class="halign-left valign-top">rd ← Memory[[rs1] + imm<sub>11:0</sub>]</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">sw</td><td class="halign-left valign-top">sw rs2,imm<sub>11:0</sub>(rs1)</td><td class="halign-left valign-top">Memory[[rs1] + imm<sub>11:0</sub>] ← [rs2];</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">lui</td><td class="halign-left valign-top">lui rd, imm<sub>31:12</sub></td><td class="halign-left valign-top">rd ← {imm<sub>31:12</sub>,'0000 0000 0000'};</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">jal</td><td class="halign-left valign-top">jal rd, imm<sub>20:1</sub></td><td class="halign-left valign-top">rd ← [PC]+4; go to [PC] +{imm<sub>20:1</sub>,'0'};</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">jalr</td><td class="halign-left valign-top">jalr rd, rs1, imm<sub>11:0</sub></td><td class="halign-left valign-top">rd ← [PC]+4; go to [rs1]+imm<sub>11:0</sub>;</td><td class="halign-left valign-top"></td></tr></tbody></table></div></section>
<section class="doc-section level-3"><h4 id="_extended-cpu-design"><a class="anchor" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#_extended-cpu-design" aria-hidden="true"></a>Extended CPU design</h4><p>Add to the processor the support for: auipc, sll, srl, sra.</p>
<div class="table-block"><table class="frame-all grid-all"><colgroup><col><col><col><col></colgroup><tbody><tr><th class="halign-left valign-top">Instruction</th><th class="halign-left valign-top">Syntax</th><th class="halign-left valign-top">Operation</th><th class="halign-left valign-top">Note</th></tr><tr><td class="halign-left valign-top">auipc</td><td class="halign-left valign-top">auipc rd,imm<sub>31:12</sub></td><td class="halign-left valign-top">rd ← [PC] + {imm<sub>31:12</sub>,'0000 0000 0000'};</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">sll</td><td class="halign-left valign-top">sll rd, rs1, rs2</td><td class="halign-left valign-top">rd ← [rs1] &lt;&lt; [rs2];</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">srl</td><td class="halign-left valign-top">srl rd, rs1, rs2</td><td class="halign-left valign-top">rd ← (unsigned)[rs1] &gt;&gt; [rs2];</td><td class="halign-left valign-top"></td></tr><tr><td class="halign-left valign-top">sra</td><td class="halign-left valign-top">sra rd, rs1, rs2</td><td class="halign-left valign-top">rd ← (signed)[rs1] &gt;&gt; [rs2];</td><td class="halign-left valign-top"></td></tr></tbody></table></div>
<p>Note: The submission system tests these instructions sequentially (in some order). If it finds an incorrect implementation, it does not continue testing and it displays the number of points. Because this is an extended design, it no longer provides a hint.</p>
<p><strong>Instruction encoding:</strong></p>
<p>Each instruction is encoded in 32 bits (in the table from msb towards lsb), where rs1, rs2 and rd are encoded in 5 bits. Very last column of the table represents Opcode of the instruction.</p>
<div class="table-block"><table class="frame-all grid-all stretch"><colgroup><col style="width: 9.1743%;"><col style="width: 20.1834%;"><col style="width: 13.7614%;"><col style="width: 13.7614%;"><col style="width: 9.1743%;"><col style="width: 13.7614%;"><col style="width: 20.1838%;"></colgroup><tbody><tr><td class="halign-left valign-top">add:</td><td class="halign-center valign-top">0000000</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">000</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0110011</td></tr><tr><td class="halign-left valign-top">addi</td><td class="halign-center valign-top" colspan="2">imm[11:0]</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">000</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0010011</td></tr><tr><td class="halign-left valign-top">adduqb:</td><td class="halign-center valign-top">0000000</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">000</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0001011</td></tr><tr><td class="halign-left valign-top">and:</td><td class="halign-center valign-top">0000000</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">111</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0110011</td></tr><tr><td class="halign-left valign-top">sub:</td><td class="halign-center valign-top">0100000</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">000</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0110011</td></tr><tr><td class="halign-left valign-top">slt:</td><td class="halign-center valign-top">0000000</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">010</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0110011</td></tr><tr><td class="halign-left valign-top">beq:</td><td class="halign-center valign-top">imm[12|10:5]</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">000</td><td class="halign-center valign-top">imm[4:1|11]</td><td class="halign-center valign-top">1100011</td></tr><tr><td class="halign-left valign-top">lw:</td><td class="halign-center valign-top" colspan="2">imm[11:0]</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">010</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0000011</td></tr><tr><td class="halign-left valign-top">sw:</td><td class="halign-center valign-top">imm[11:5]</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">010</td><td class="halign-center valign-top">imm[4:0]</td><td class="halign-center valign-top">0100011</td></tr><tr><td class="halign-left valign-top">lui:</td><td class="halign-center valign-top" colspan="4">imm[31:12]</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0110111</td></tr><tr><td class="halign-left valign-top">jal:</td><td class="halign-center valign-top" colspan="4">imm[20|10:1|11|19:12]</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">1101111</td></tr><tr><td class="halign-left valign-top">jalr:</td><td class="halign-center valign-top" colspan="2">imm[11:0]</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">000</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">1100111</td></tr><tr><td class="halign-left valign-top">auipc:</td><td class="halign-center valign-top" colspan="4">imm[31:12]</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0010111</td></tr><tr><td class="halign-left valign-top">sll:</td><td class="halign-center valign-top">0000000</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">001</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0110011</td></tr><tr><td class="halign-left valign-top">srl:</td><td class="halign-center valign-top">0000000</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">101</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0110011</td></tr><tr><td class="halign-left valign-top">sra:</td><td class="halign-center valign-top">0100000</td><td class="halign-center valign-top">rs2</td><td class="halign-center valign-top">rs1</td><td class="halign-center valign-top">101</td><td class="halign-center valign-top">rd</td><td class="halign-center valign-top">0110011</td></tr></tbody></table></div></section>
<section class="doc-section level-3"><h4 id="_program-s"><a class="anchor" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#_program-s" aria-hidden="true"></a>Program S</h4><p>Write a program called S in the RISC-V assembly language that merges two images into one image. We will use image format described later. Program calls a subroutine merge() with the following C-language  prototype:</p>
<div class="listing-block"><pre>int merge(int *inputImgA, int *inputImgB, int *outputImg);</pre></div>
<p>This subroutine should return the number of pixels of the output image. Use the RISC-V calling convention.</p>
<p>Suppose that the input adresses for the subroutine are stored in the data memory at following adresses:</p>
<div class="ulist"><ul><li>0x00000004: inputImgA</li><li>0x00000008: inputImgB</li><li>0x0000000C: outputImg</li></ul></div>
<p>For instance, at address 0x00000004 the address of inputImgA is stored (where the image begins).</p>
<p>After returning from the subroutine, program should write the returned result (i.e. the number of pixels of the output image) into the data memory at address of 0x00000010.</p>
<p>Translate program S from the RISC-V assembly language into the machine code of your CPU design.</p>
<p><strong>Image format:</strong>
Image starts with a header consisting of a 4-byte signature 0x5350412e (i.e. ".APS" in ASCII) followed by image width (4 bytes) and image height (4 bytes). After the header, comes a series of individual pixels. Each pixel (4 bytes) encodes red, green, blue and alpha channel (in this ordering), each of which is 1 byte long (8 bits). Red channel is encoded in LSB, whereas alpha channel is encoded in MSB.</p>
<p>An example of the 2x3 image in hexadecimal:</p>
<div class="listing-block"><pre>5350412e
00000002
00000003
11223300
2200aaff
00ffff00
03565654
1b459748
ecf39baa</pre></div>
<p><strong>Algorithm:</strong>
For every pixel of the output image:</p>
<div class="ulist"><ul><li>set aplha channel to 0xFF</li><li>output color channel (i.e., red, green and blue) is computed as the sum of corresponding channels of the input pixels. There is no need to treat overflow (i.e. if the sum is greather than 0xFF, only lower 8 bits are used).</li></ul></div>
<p>Only the images with the same size can be merged. Input images have always the same size (no need to test it).</p>
<aside class="admonition-block note" role="note"><h6 class="block-title label-only"><span class="title-label">Note: </span></h6><p>If you got 0 points for your program, there is a change it is the result of incomplete/poor CPU description.</p></aside></section>
<section class="doc-section level-2"><h3 id="_seminar-project-evaluation"><a class="anchor" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#_seminar-project-evaluation" aria-hidden="true"></a>Seminar project evaluation</h3><div class="table-block"><table class="frame-all grid-all"><colgroup><col><col></colgroup><tbody><tr><th class="halign-left valign-top">Description</th><th class="halign-left valign-top">Points</th></tr><tr><td class="halign-left valign-top">Basic CPU design in Verilog</td><td class="halign-left valign-top">12</td></tr><tr><td class="halign-left valign-top">Extended CPU design:</td><td class="halign-left valign-top">4</td></tr><tr><td class="halign-left valign-top">Program S in the machine code</td><td class="halign-left valign-top">9</td></tr></tbody></table></div>
<p>Soft deadline: November <s>14</s> 21, 2021. Each week delay is sanctioned with -2 points. Submissions after the 13th week of the semester are not accepted (hard deadline).</p>
<section class="admonition-block important" role="doc-notice"><h6 class="block-title label-only"><span class="title-label">Important: </span></h6><p>Your program has to run on your CPU design, i.e. you can get 9 points for your program only if you provide your  description of the CPU in Verilog.</p></section></section>
<section class="doc-section level-2"><h3 id="_the-requirements-for-semester-project-documentation"><a class="anchor" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#_the-requirements-for-semester-project-documentation" aria-hidden="true"></a>The requirements for semester project documentation</h3><div class="ulist"><ul><li>Your semester project will be submitted as zipped archive <strong>Surname_FirstName.zip</strong> of three files.</li><li>The first file named <strong>Surname_FirstName_CPU.v</strong> should contain all source codes in Verilog.</li></ul></div>
<section class="admonition-block important" role="doc-notice"><h6 class="block-title label-only"><span class="title-label">Important: </span></h6><p>Include the Verilog description only for the CPU. Do not include the description of other components (data memory, instruction memory, etc.).</p></section>
<p>Use the following template:</p>
<div class="listing-block"><pre>`default_nettype none
module processor( input         clk, reset,
                  output [31:0] PC,
                  input  [31:0] instruction,
                  output        WE,
                  output [31:0] address_to_mem,
                  output [31:0] data_to_mem,
                  input  [31:0] data_from_mem
                );
    //... write your code here ...
endmodule

//... add new Verilog modules here ...
`default_nettype wire</pre></div>
<p>You can add and use new Verilog modules as you wish.</p>
<div class="ulist"><ul><li>The second file named <strong>Surname_FirstName_prog1.asm</strong> should contain program S in the RISC-V assembly language.</li><li>The third file named <strong>Surname_FirstName_prog1.hex</strong> should contain program S in the hexadecimal format (one instruction per line).</li></ul></div></section>
<section class="doc-section level-2"><h3 id="_submition-of-your-semester-project"><a class="anchor" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#_submition-of-your-semester-project" aria-hidden="true"></a>Submition of your semester project</h3><p>Submit the zip archive <strong>Surname_FirstName.zip</strong> to the web page <a class="bare" href="http://biaps.fit.cvut.cz/first_semestral_project/index.php">http://biaps.fit.cvut.cz/first_semestral_project/index.php</a>.</p>
<p>You must authenticate using the last 4 digits of your ID number = the number found on your ISIC card or found on <a class="bare" href="https://usermap.cvut.cz/">https://usermap.cvut.cz</a>.</p></section>
<section class="doc-section level-2"><h3 id="_hints"><a class="anchor" href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html#_hints" aria-hidden="true"></a>Hints</h3><p>You can use the MARS simulator to generate the machine code of program S. See figure bellow. Note: MARS implements  RISC-V ISA, which slightly differs from picoMIPS ISA - see the definition of instructions described above (there is no addu.qb instruction).</p>
<div class="image-block"><img src="./CPU_files/MARS_01.png" alt="MARS 01" width="1005"></div>
<p>You can use the following Verilog modules to represent the whole computer system. If the data and instruction memory arrays of vectors are not large enough, extend them. However, please <strong>do not</strong> include them into the <strong>Surname_FirstName_CPU.v</strong> file.</p>
<div class="listing-block"><pre>module top (	input         clk, reset,
		output [31:0] data_to_mem, address_to_mem,
		output        write_enable);

	wire [31:0] pc, instruction, data_from_mem;

	inst_mem  imem(pc[7:2], instruction);
	data_mem  dmem(clk, write_enable, address_to_mem, data_to_mem, data_from_mem);
	processor CPU(clk, reset, pc, instruction, write_enable, address_to_mem, data_to_mem, data_from_mem);
endmodule

//-------------------------------------------------------------------
module data_mem (input clk, we,
		 input  [31:0] address, wd,
		 output [31:0] rd);

	reg [31:0] RAM[63:0];

	initial begin
		$readmemh ("memfile_data.hex",RAM,0,63);
	end

	assign rd=RAM[address[31:2]]; // word aligned

	always @ (posedge clk)
		if (we)
			RAM[address[31:2]]&lt;=wd;
endmodule

//-------------------------------------------------------------------
module inst_mem (input  [5:0]  address,
		 output [31:0] rd);

	reg [31:0] RAM[63:0];
	initial begin
		$readmemh ("memfile_inst.hex",RAM,0,63);
	end
	assign rd=RAM[address]; // word aligned
endmodule</pre></div>
<p>And for the simulation, you can use the following template:</p>
<div class="listing-block"><pre>module testbench();
	reg         clk;
	reg         reset;
	wire [31:0] data_to_mem, address_to_mem;
	wire        memwrite;

	top simulated_system (clk, reset, data_to_mem, address_to_mem, write_enable);

	initial	begin
		$dumpfile("test");
		$dumpvars;
		reset&lt;=1; # 2; reset&lt;=0;
		#100; $finish;
	end

	// generate clock
	always	begin
		clk&lt;=1; # 1; clk&lt;=0; # 1;
	end
endmodule</pre></div></section></section>
    </main>
    <nav class="site-nav" id="nav">
      <div class="other-version hidden" id="version-msg">
        <div id="version-msg-history-icon" class="hidden"><span class="icon icon-history"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="history" width="50" height="50" fill="none"></rect><path d="M10.861 10.861A19.934 19.934 0 0 1 25 5c11.038 0 20 8.962 20 20s-8.962 20-20 20S5 36.038 5 25" fill="none" stroke="#000" stroke-width="3"></path><path d="M10 5v7h7M20 33l6-5V15" fill="none" stroke="#000" stroke-width="3"></path></svg></span></div>
        <div id="version-msg-other-icon" class="hidden"><span class="icon icon-eye"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="eye" width="50" height="50" fill="none"></rect><path d="M5 25s7.103-10 20-10 20 10 20 10-7.476 10-20 10C12.476 35 5 25 5 25z" fill="none" stroke="#000" stroke-width="3"></path><circle cx="25" cy="25" r="6" fill="none" stroke="#000" stroke-width="3"></circle></svg></span></div>
        You’re browsing the <strong id="version-msg-branch">...</strong> version.<br>
        <a href="https://courses.fit.cvut.cz/BIE-APS/">Go to the latest version.</a>
      </div>
      <h1>Course navigation</h1>
      <ul class="link-list">
        <li class="">
          <a href="https://courses.fit.cvut.cz/BIE-APS/index.html">
            <span class="icon icon-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="home" width="50" height="50" fill="none"></rect><path d="M5 28L25 8l20 20" fill="none" stroke="#000" stroke-width="3"></path><path d="M12 22v20h26V22" fill="none" stroke="#000" stroke-width="3"></path></svg></span> <span class="label">BIE-APS - News</span>
          </a>
        </li>
            <li class="collapsed">
              <a href="https://courses.fit.cvut.cz/BIE-APS/classification/index.html">
                  <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">Evaluation, assessment, exam, and grading</span>
              </a>
            </li>
            <li class="collapsed">
              <a href="https://courses.fit.cvut.cz/BIE-APS/lectures/index.html">
                  <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">Lectures</span>
              </a>
            </li>
            <li class="collapsed">
              <a href="https://courses.fit.cvut.cz/BIE-APS/news/index.html">
                  <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">News</span>
              </a>
            </li>
            <li class="">
                <a class="expander" aria-hidden="true">
                  <span class="icon icon-expand"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="expand" width="50" height="50" fill="none"></rect><path d="M10 20.25l15.105 9.5L40 20.25" fill="none" stroke="#000" stroke-width="3"></path></svg></span>
                </a>
              <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/index.html">
                  <span class="icon icon-folder"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="folder" width="50" height="50" fill="none"></rect><path d="M3.5 8.66v32.68h43V14.68H25l-4.3-6.02H3.5z" fill="none" stroke="#000" stroke-width="3"></path></svg></span> <span class="label">Seminars</span>
              </a>
                  <ul>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/01/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">1. Seminar - Computer Performance Measurement</span>
                          </a>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/02/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">2. Seminar -  ISA and the RISC-V assembly language</span>
                          </a>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/03/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">3.  Programming in assembly language for RISC-V: calling convention, instruction encoding and machine code generation.</span>
                          </a>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/04/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">4. Hardware description language (Verilog)</span>
                          </a>
                        </li>
                        <li class="">
                            <a class="expander" aria-hidden="true">
                              <span class="icon icon-expand"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="expand" width="50" height="50" fill="none"></rect><path d="M10 20.25l15.105 9.5L40 20.25" fill="none" stroke="#000" stroke-width="3"></path></svg></span>
                            </a>
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/index.html">
                              <span class="icon icon-folder"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="folder" width="50" height="50" fill="none"></rect><path d="M3.5 8.66v32.68h43V14.68H25l-4.3-6.02H3.5z" fill="none" stroke="#000" stroke-width="3"></path></svg></span> <span class="label">5. Seminar - Basic computer components II, Single cycle CPU</span>
                          </a>
                              <ul>
                                    <li class="selected">
                                      <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/05/semester_project.html">
                                          <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">Seminar project #1: Single-cycle CPU design</span>
                                      </a>
                                    </li>
                              </ul>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/06/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">6.  Seminar - Pipelined microarchitecture</span>
                          </a>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/07/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">7.  Seminar - Cache - Introduction</span>
                          </a>
                        </li>
                        <li class="collapsed">
                            <a class="expander" aria-hidden="true">
                              <span class="icon icon-expand"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="expand" width="50" height="50" fill="none"></rect><path d="M10 20.25l15.105 9.5L40 20.25" fill="none" stroke="#000" stroke-width="3"></path></svg></span>
                            </a>
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/08/index.html">
                              <span class="icon icon-folder"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="folder" width="50" height="50" fill="none"></rect><path d="M3.5 8.66v32.68h43V14.68H25l-4.3-6.02H3.5z" fill="none" stroke="#000" stroke-width="3"></path></svg></span> <span class="label">8. Seminar - Cache - Accessing memory from C programs, Virtual memory</span>
                          </a>
                              <ul>
                                    <li class="collapsed">
                                      <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/08/seminar_project.html">
                                          <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">Seminar project #2: Cache access optimization</span>
                                      </a>
                                    </li>
                              </ul>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/09/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">9. Seminar - Cache - Coherence and coherence protocols, Explanation of MESI protocol</span>
                          </a>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/10/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">10. Seminar - Memory consistency and multithreaded programs</span>
                          </a>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/11/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">11. Seminar - Sequential consistency</span>
                          </a>
                        </li>
                        <li class="collapsed">
                          <a href="https://courses.fit.cvut.cz/BIE-APS/tutorials/12/index.html">
                              <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">12. Seminar - Superscalar processors, Evaluation of assignments, credit</span>
                          </a>
                        </li>
                  </ul>
            </li>
            <li class="collapsed">
              <a href="https://courses.fit.cvut.cz/BIE-APS/teacher/index.html">
                  <span class="icon icon-file-text"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="square" stroke-miterlimit="1.5"><rect id="file-text" width="50" height="50" fill="none"></rect><g fill="none" stroke="#000" stroke-width="3"><path d="M8.647 4.559v40.882h32.706V15.188L30.724 4.559H8.647z"></path><path d="M29.088 4.559v12.265h12.265"></path></g><g fill="none" stroke="#000" stroke-width="3"><path d="M14.371 38.082h17.17M14.371 32.359h8.585M14.371 26.635h13.9"></path></g></svg></span> <span class="label">Teachers</span>
              </a>
            </li>
      </ul>
    </nav>
  </div>
</div>
<footer class="page-footer">
  <div class="wrap">
    <div class="meta">
      Seminar project #1: Single-cycle CPU design        <br>
        <a href="https://gitlab.fit.cvut.cz/BI-APS/bie-aps/blob/master/tutorials/05/semester_project.adoc" target="_blank">
          tutorials/05/semester_project.adoc</a>,
        <a href="https://gitlab.fit.cvut.cz/BI-APS/bie-aps/commit/5bcbc904b5596c573c4a56534beb1dff7c2d18fb" target="_blank" title="Update tutorials/05/semester_project.adoc">
          last change 5bcbc904 (<time datetime="2021-11-11T17:39:57.000Z">2021-11-11 at 18:39</time>, Ing. Michal Štepanovský, Ph.D)
        </a>
    </div>
    <div class="coursepages">
Generated with         <a href="https://gitlab.fit.cvut.cz/course-pages/course-pages/" target="_blank"><strong>FIT CTU Course Pages</strong></a> v0.8.0
      <br>
      Page generated at <time datetime="2021-11-11T17:40:20.137Z">2021-11-11 at 18:40</time>
    </div>
      <div class="buildstatus">
        <a href="https://gitlab.fit.cvut.cz/BI-APS/bie-aps/pipelines" target="_blank">
          <img src="./CPU_files/pipeline.svg" alt="Build status">
        </a>
      </div>
  </div>
</footer>
  

</body></html>